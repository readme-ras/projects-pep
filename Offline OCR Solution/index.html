<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OCR â€” Offline Text Extraction</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:       #0e0f11;
    --surface:  #16181c;
    --surface2: #1e2128;
    --border:   #272b34;
    --border2:  #353b47;
    --amber:    #f5a623;
    --amber2:   #e8941a;
    --amber-bg: rgba(245,166,35,0.07);
    --green:    #3dd68c;
    --red:      #f05252;
    --blue:     #60a5fa;
    --text:     #d4d8e2;
    --text2:    #7c8495;
    --text3:    #4a5162;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    height: 100%;
    font-family: 'Syne', sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .app {
    display: grid;
    grid-template-rows: 56px 1fr;
    height: 100vh;
    overflow: hidden;
  }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 28px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    z-index: 10;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
    font-weight: 800;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--amber);
  }

  .logo-icon {
    width: 28px; height: 28px;
    background: var(--amber);
    border-radius: 4px;
    display: grid;
    place-items: center;
    font-size: 14px;
    color: #000;
    font-weight: 900;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 20px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text3);
  }

  .engine-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border: 1px solid var(--border2);
    border-radius: 3px;
    font-size: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--text3);
  }
  .dot.ok  { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .dot.err { background: var(--red); }

  /* â”€â”€ Main content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .main {
    display: grid;
    grid-template-columns: 400px 1fr;
    overflow: hidden;
  }

  /* â”€â”€ Left panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .left-panel {
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border);
    overflow: hidden;
  }

  .panel-section {
    padding: 20px;
    border-bottom: 1px solid var(--border);
  }

  .section-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text3);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* â”€â”€ Drop zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .drop-zone {
    border: 2px dashed var(--border2);
    border-radius: 8px;
    padding: 32px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.25s;
    background: var(--surface2);
    position: relative;
    overflow: hidden;
  }

  .drop-zone::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 110%, rgba(245,166,35,0.06) 0%, transparent 70%);
    pointer-events: none;
  }

  .drop-zone:hover, .drop-zone.drag-over {
    border-color: var(--amber);
    background: var(--amber-bg);
  }

  .drop-zone.has-image {
    border-color: var(--green);
    border-style: solid;
  }

  .drop-icon {
    font-size: 32px;
    margin-bottom: 10px;
    display: block;
  }

  .drop-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 4px;
  }

  .drop-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text3);
  }

  #fileInput { display: none; }

  .preview-img {
    width: 100%;
    max-height: 180px;
    object-fit: contain;
    border-radius: 4px;
    display: none;
  }

  .drop-zone.has-image .drop-icon,
  .drop-zone.has-image .drop-title,
  .drop-zone.has-image .drop-sub { display: none; }
  .drop-zone.has-image .preview-img { display: block; }

  /* â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .controls-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 12px;
  }

  .control-group { display: flex; flex-direction: column; gap: 5px; }

  .ctrl-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  select, .toggle-row {
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 4px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    padding: 7px 10px;
    outline: none;
    transition: border-color 0.2s;
    cursor: pointer;
  }

  select:focus { border-color: var(--amber); }

  .toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 6px;
    padding: 7px 10px;
    cursor: default;
  }

  .toggle {
    position: relative;
    width: 32px; height: 18px;
    cursor: pointer;
    flex-shrink: 0;
  }

  .toggle input { opacity: 0; width: 0; height: 0; }

  .toggle-slider {
    position: absolute;
    inset: 0;
    background: var(--border2);
    border-radius: 18px;
    transition: background 0.2s;
  }

  .toggle-slider::after {
    content: '';
    position: absolute;
    left: 3px; top: 3px;
    width: 12px; height: 12px;
    border-radius: 50%;
    background: white;
    transition: transform 0.2s;
  }

  .toggle input:checked + .toggle-slider { background: var(--amber); }
  .toggle input:checked + .toggle-slider::after { transform: translateX(14px); }

  /* â”€â”€ Run button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .run-btn {
    width: 100%;
    padding: 12px;
    background: var(--amber);
    color: #000;
    border: none;
    border-radius: 6px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 800;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .run-btn:hover:not(:disabled) { background: var(--amber2); transform: translateY(-1px); }
  .run-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  /* Spinner */
  .spinner {
    width: 14px; height: 14px;
    border: 2px solid rgba(0,0,0,0.3);
    border-top-color: #000;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    display: none;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ Stats bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stats-bar {
    display: flex;
    gap: 0;
    padding: 10px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
  }

  .stat-item {
    flex: 1;
    text-align: center;
  }

  .stat-item + .stat-item {
    border-left: 1px solid var(--border);
  }

  .stat-val {
    font-family: 'JetBrains Mono', monospace;
    font-size: 16px;
    font-weight: 700;
    color: var(--amber);
  }

  .stat-key {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-top: 2px;
  }

  /* â”€â”€ Right panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .right-panel {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .result-tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    padding: 0 20px;
    flex-shrink: 0;
  }

  .tab {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 14px 14px;
    color: var(--text3);
    border-bottom: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
  }

  .tab:hover { color: var(--text); }
  .tab.active { color: var(--amber); border-bottom-color: var(--amber); }

  .tab-content { display: none; flex: 1; overflow: hidden; }
  .tab-content.active { display: flex; flex-direction: column; }

  /* â”€â”€ Text output â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .text-output-wrap {
    flex: 1;
    overflow: auto;
    padding: 24px;
    scrollbar-width: thin;
    scrollbar-color: var(--border2) transparent;
  }

  .text-output {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    line-height: 1.8;
    color: var(--text);
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 200px;
  }

  .output-actions {
    display: flex;
    gap: 8px;
    padding: 12px 24px;
    border-top: 1px solid var(--border);
    background: var(--surface);
    flex-shrink: 0;
  }

  .btn-sm {
    padding: 6px 14px;
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    border: 1px solid var(--border2);
    background: var(--surface2);
    color: var(--text2);
    transition: all 0.2s;
  }

  .btn-sm:hover { border-color: var(--amber); color: var(--amber); }

  /* â”€â”€ Extracted data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .extracted-wrap {
    flex: 1;
    overflow: auto;
    padding: 20px 24px;
    scrollbar-width: thin;
    scrollbar-color: var(--border2) transparent;
  }

  .doc-type-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 3px;
    background: var(--amber-bg);
    border: 1px solid var(--amber);
    color: var(--amber);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 20px;
  }

  .data-section { margin-bottom: 20px; }

  .data-section-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .data-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .chip {
    padding: 4px 10px;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 3px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text);
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .chip:hover { border-color: var(--amber); color: var(--amber); }
  .chip.email { border-color: rgba(96,165,250,0.4); color: var(--blue); }
  .chip.phone { border-color: rgba(61,214,140,0.4); color: var(--green); }
  .chip.amount { border-color: rgba(245,166,35,0.4); color: var(--amber); }

  .no-data { color: var(--text3); font-family: 'JetBrains Mono', monospace; font-size: 12px; }

  /* â”€â”€ Preview tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .preview-wrap {
    flex: 1;
    overflow: auto;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 20px;
    gap: 20px;
  }

  .preview-card {
    flex: 1;
    max-width: 420px;
  }

  .preview-card-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .preview-card img {
    width: 100%;
    border-radius: 6px;
    border: 1px solid var(--border2);
    display: block;
  }

  /* â”€â”€ Empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .empty-state {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--text3);
    gap: 12px;
    padding: 40px;
  }

  .empty-icon { font-size: 48px; opacity: 0.3; }

  .empty-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    text-align: center;
    letter-spacing: 0.05em;
    line-height: 1.8;
  }

  /* â”€â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .error-banner {
    padding: 12px 20px;
    background: rgba(240,82,82,0.1);
    border: 1px solid rgba(240,82,82,0.3);
    border-radius: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--red);
    margin: 16px 24px;
    display: none;
  }

  /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 18px;
    background: var(--surface2);
    border: 1px solid var(--amber);
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--amber);
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.25s;
    z-index: 100;
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  /* scrollbars */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
</style>
</head>
<body>
<div class="app">

  <!-- Header -->
  <header>
    <div class="logo">
      <div class="logo-icon">âŒ¶</div>
      OCR Engine
    </div>
    <div class="header-right">
      <div class="engine-badge" id="tesseractBadge">
        <div class="dot" id="tessStatus"></div>
        Tesseract
      </div>
      <div class="engine-badge" id="easyBadge">
        <div class="dot" id="easyStatus"></div>
        EasyOCR
      </div>
      <span>OFFLINE</span>
    </div>
  </header>

  <!-- Main -->
  <div class="main">

    <!-- Left panel -->
    <div class="left-panel">

      <!-- Drop zone -->
      <div class="panel-section">
        <div class="section-label">Image Input</div>
        <div class="drop-zone" id="dropZone">
          <span class="drop-icon">âŒ¶</span>
          <div class="drop-title">Drop image here</div>
          <div class="drop-sub">or click to browse Â· PNG, JPG, BMP, TIFF, WebP</div>
          <img class="preview-img" id="previewImg" alt="preview"/>
        </div>
        <input type="file" id="fileInput" accept="image/*"/>
      </div>

      <!-- Controls -->
      <div class="panel-section">
        <div class="section-label">Settings</div>
        <div class="controls-grid">
          <div class="control-group">
            <span class="ctrl-label">Engine</span>
            <select id="engineSelect">
              <option value="auto">Auto (best)</option>
              <option value="tesseract">Tesseract</option>
              <option value="easyocr">EasyOCR</option>
            </select>
          </div>
          <div class="control-group">
            <span class="ctrl-label">Language</span>
            <select id="langSelect">
              <option value="eng">English</option>
              <option value="fra">French</option>
              <option value="deu">German</option>
              <option value="spa">Spanish</option>
              <option value="por">Portuguese</option>
              <option value="ita">Italian</option>
              <option value="chi_sim">Chinese (Simplified)</option>
              <option value="jpn">Japanese</option>
              <option value="ara">Arabic</option>
              <option value="hin">Hindi</option>
            </select>
          </div>
        </div>
        <div class="controls-grid">
          <div class="control-group">
            <span class="ctrl-label">Enhance Image</span>
            <label class="toggle-row">
              <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text2)">Denoise + sharpen</span>
              <label class="toggle"><input type="checkbox" id="enhanceToggle" checked/><span class="toggle-slider"></span></label>
            </label>
          </div>
          <div class="control-group">
            <span class="ctrl-label">Extract Data</span>
            <label class="toggle-row">
              <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text2)">Emails, dates...</span>
              <label class="toggle"><input type="checkbox" id="extractToggle" checked/><span class="toggle-slider"></span></label>
            </label>
          </div>
        </div>
        <button class="run-btn" id="runBtn" disabled>
          <div class="spinner" id="spinner"></div>
          <span id="runBtnText">Extract Text</span>
        </button>
      </div>

      <!-- Stats -->
      <div class="stats-bar" id="statsBar" style="display:none">
        <div class="stat-item">
          <div class="stat-val" id="statConf">â€”</div>
          <div class="stat-key">Confidence</div>
        </div>
        <div class="stat-item">
          <div class="stat-val" id="statWords">â€”</div>
          <div class="stat-key">Words</div>
        </div>
        <div class="stat-item">
          <div class="stat-val" id="statTime">â€”</div>
          <div class="stat-key">Time (ms)</div>
        </div>
        <div class="stat-item">
          <div class="stat-val" id="statEngine">â€”</div>
          <div class="stat-key">Engine</div>
        </div>
      </div>

    </div>

    <!-- Right panel -->
    <div class="right-panel">

      <!-- Tabs -->
      <div class="result-tabs">
        <button class="tab active" data-tab="text">Extracted Text</button>
        <button class="tab" data-tab="data">Smart Extract</button>
        <button class="tab" data-tab="preview">Preview</button>
      </div>

      <!-- Error -->
      <div class="error-banner" id="errorBanner"></div>

      <!-- Text tab -->
      <div class="tab-content active" id="tab-text">
        <div class="text-output-wrap">
          <div class="text-output" id="textOutput">
            <div class="empty-state">
              <div class="empty-icon">âŒ¶</div>
              <div class="empty-text">Upload an image and click<br/>"Extract Text" to begin.</div>
            </div>
          </div>
        </div>
        <div class="output-actions" id="outputActions" style="display:none">
          <button class="btn-sm" onclick="copyText()">Copy Text</button>
          <button class="btn-sm" onclick="downloadTxt()">Download .txt</button>
          <button class="btn-sm" onclick="downloadJson()">Download JSON</button>
        </div>
      </div>

      <!-- Data tab -->
      <div class="tab-content" id="tab-data">
        <div class="extracted-wrap" id="extractedWrap">
          <div class="empty-state">
            <div class="empty-icon">ğŸ”</div>
            <div class="empty-text">Extracted entities will appear here.<br/>Enable "Extract Data" and run OCR.</div>
          </div>
        </div>
      </div>

      <!-- Preview tab -->
      <div class="tab-content" id="tab-preview">
        <div class="preview-wrap" id="previewWrap">
          <div class="empty-state">
            <div class="empty-icon">ğŸ–¼ï¸</div>
            <div class="empty-text">Original and preprocessed images<br/>appear here after extraction.</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
const API = '';   // same origin
let currentFile = null;
let lastResult  = null;

// â”€â”€ Engine status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function checkEngines() {
  try {
    const res  = await fetch(`${API}/ocr/engines`);
    const data = await res.json();
    document.getElementById('tessStatus').className = 'dot ' + (data.engines.tesseract ? 'ok' : 'err');
    document.getElementById('easyStatus').className = 'dot ' + (data.engines.easyocr   ? 'ok' : 'err');
  } catch { /* API not running */ }
}

// â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
  });
});

// â”€â”€ Drop zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const previewImg = document.getElementById('previewImg');

dropZone.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', e => e.target.files[0] && loadFile(e.target.files[0]));

dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('drag-over');
  const f = e.dataTransfer.files[0];
  if (f && f.type.startsWith('image/')) loadFile(f);
});

function loadFile(file) {
  currentFile = file;
  const reader = new FileReader();
  reader.onload = ev => {
    previewImg.src = ev.target.result;
    dropZone.classList.add('has-image');
    document.getElementById('runBtn').disabled = false;
  };
  reader.readAsDataURL(file);
}

// â”€â”€ Run OCR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

document.getElementById('runBtn').addEventListener('click', runOCR);

async function runOCR() {
  if (!currentFile) return;

  setLoading(true);
  hideError();

  const fd = new FormData();
  fd.append('file',    currentFile);
  fd.append('engine',  document.getElementById('engineSelect').value);
  fd.append('lang',    document.getElementById('langSelect').value);
  fd.append('enhance', document.getElementById('enhanceToggle').checked);
  fd.append('extract', document.getElementById('extractToggle').checked);

  try {
    const res = await fetch(`${API}/ocr/upload`, { method: 'POST', body: fd });
    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.detail || `HTTP ${res.status}`);
    }
    lastResult = await res.json();
    displayResult(lastResult);
  } catch (err) {
    showError(err.message);
  } finally {
    setLoading(false);
  }
}

// â”€â”€ Display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function displayResult(data) {
  // Stats bar
  const ex = data.extracted || {};
  document.getElementById('statsBar').style.display = 'flex';
  document.getElementById('statConf').textContent   = (data.confidence || 0).toFixed(1) + '%';
  document.getElementById('statWords').textContent  = ex.word_count || data.text?.split(/\s+/).length || 'â€”';
  document.getElementById('statTime').textContent   = data.time_ms || 'â€”';
  document.getElementById('statEngine').textContent = (data.engine || 'â€”').toUpperCase();

  // Text tab
  const textEl = document.getElementById('textOutput');
  if (data.text && data.text.trim()) {
    textEl.textContent = data.text;
    document.getElementById('outputActions').style.display = 'flex';
  } else {
    textEl.innerHTML = '<div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-text">No text could be extracted.<br/>Try a different engine or adjust settings.</div></div>';
    document.getElementById('outputActions').style.display = 'none';
  }

  // Extracted data tab
  renderExtracted(data.extracted);

  // Preview tab
  renderPreview(data);
}

function renderExtracted(ex) {
  const wrap = document.getElementById('extractedWrap');
  if (!ex) {
    wrap.innerHTML = '<div class="empty-state"><div class="empty-icon">â„¹ï¸</div><div class="empty-text">Enable "Extract Data" to see entities.</div></div>';
    return;
  }

  const sections = [
    { key: 'emails',  label: 'Emails',   cls: 'email'  },
    { key: 'phones',  label: 'Phones',   cls: 'phone'  },
    { key: 'dates',   label: 'Dates',    cls: ''        },
    { key: 'amounts', label: 'Amounts',  cls: 'amount' },
    { key: 'urls',    label: 'URLs',     cls: ''        },
    { key: 'numbers', label: 'Numbers',  cls: ''        },
  ];

  let html = `<div class="doc-type-badge">ğŸ“„ ${ex.doc_type || 'document'}</div>`;
  html += `<div class="controls-grid" style="margin-bottom:16px">
    <div class="stat-item" style="border:1px solid var(--border2);border-radius:4px;padding:10px">
      <div class="stat-val">${ex.word_count}</div><div class="stat-key">Words</div>
    </div>
    <div class="stat-item" style="border:1px solid var(--border2);border-radius:4px;padding:10px">
      <div class="stat-val">${ex.line_count}</div><div class="stat-key">Lines</div>
    </div>
  </div>`;

  let hasAny = false;
  for (const { key, label, cls } of sections) {
    const items = ex[key] || [];
    if (!items.length) continue;
    hasAny = true;
    html += `<div class="data-section">
      <div class="data-section-title">${label}</div>
      <div class="data-chips">
        ${items.map(i => `<span class="chip ${cls}" title="click to copy" onclick="copyChip('${esc(i)}')">${esc(i)}</span>`).join('')}
      </div>
    </div>`;
  }

  if (!hasAny) {
    html += '<div class="no-data">No structured data entities detected.</div>';
  }

  wrap.innerHTML = html;
}

function renderPreview(data) {
  const wrap = document.getElementById('previewWrap');
  let html = '';

  if (currentFile) {
    const src = URL.createObjectURL(currentFile);
    html += `<div class="preview-card"><div class="preview-card-title">Original</div><img src="${src}"/></div>`;
  }

  if (data.preview_b64) {
    html += `<div class="preview-card"><div class="preview-card-title">Preprocessed</div><img src="data:image/png;base64,${data.preview_b64}"/></div>`;
  }

  wrap.innerHTML = html || '<div class="empty-state"><div class="empty-icon">ğŸ–¼ï¸</div><div class="empty-text">No preview available.</div></div>';
}

// â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function copyText() {
  navigator.clipboard.writeText(lastResult?.text || '');
  toast('Text copied to clipboard!');
}

function copyChip(text) {
  navigator.clipboard.writeText(text);
  toast(`Copied: ${text}`);
}

function downloadTxt() {
  if (!lastResult?.text) return;
  const blob = new Blob([lastResult.text], { type: 'text/plain' });
  const a    = document.createElement('a');
  a.href     = URL.createObjectURL(blob);
  a.download = 'ocr-result.txt';
  a.click();
}

function downloadJson() {
  if (!lastResult) return;
  const blob = new Blob([JSON.stringify(lastResult, null, 2)], { type: 'application/json' });
  const a    = document.createElement('a');
  a.href     = URL.createObjectURL(blob);
  a.download = 'ocr-result.json';
  a.click();
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function setLoading(on) {
  document.getElementById('runBtn').disabled   = on;
  document.getElementById('spinner').style.display    = on ? 'block' : 'none';
  document.getElementById('runBtnText').textContent   = on ? 'Extracting...' : 'Extract Text';
}

function showError(msg) {
  const el = document.getElementById('errorBanner');
  el.textContent  = 'âš ï¸ ' + msg;
  el.style.display = 'block';
}

function hideError() {
  document.getElementById('errorBanner').style.display = 'none';
}

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

function esc(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

checkEngines();
</script>
</body>
</html>
